<!DOCTYPE html>
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if (!IE 7)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<title> &raquo; ZIL and the Z-Machine The Digital Antiquarian</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" href="http://www.filfre.net/wp-content/themes/choco/style.css" type="text/css" media="screen" />
<link rel="pingback" href="http://www.filfre.net/xmlrpc.php" />
<link rel="alternate" type="application/rss+xml" title="The Digital Antiquarian &raquo; Feed" href="http://www.filfre.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="The Digital Antiquarian &raquo; Comments Feed" href="http://www.filfre.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="The Digital Antiquarian &raquo; ZIL and the Z-Machine Comments Feed" href="http://www.filfre.net/2012/01/zil-and-the-z-machine/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.filfre.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.3.1"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='mb.miniAudioPlayer.css-css'  href='http://www.filfre.net/wp-content/plugins/wp-miniaudioplayer/css/miniplayer.css?ver=1.7.3' type='text/css' media='screen' />
<link rel='stylesheet' id='default-css'  href='http://www.filfre.net/wp-content/themes/choco/colors/default/style.css' type='text/css' media='all' />
<script type='text/javascript' src='http://www.filfre.net/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='http://www.filfre.net/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://www.filfre.net/wp-content/plugins/wp-miniaudioplayer/js/jQuery.mb.miniAudioPlayer.min.js?ver=1.7.3'></script>
<script type='text/javascript' src='http://www.filfre.net/wp-content/plugins/wp-miniaudioplayer/js/map_overwrite_default_me.js?ver=1.7.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://www.filfre.net/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://www.filfre.net/wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The Birth of Infocom' href='http://www.filfre.net/2012/01/the-birth-of-infocom/' />
<link rel='next' title='Selling Zork' href='http://www.filfre.net/2012/01/selling-zork/' />
<meta name="generator" content="WordPress 4.3.1" />
<link rel='canonical' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/' />
<link rel='shortlink' href='http://www.filfre.net/?p=345' />
<script type="text/javascript" src="http://www.filfre.net/wp-content/plugins/audio-player/assets/audio-player.js?ver=2.0.4.6"></script>
<script type="text/javascript">AudioPlayer.setup("http://www.filfre.net/wp-content/plugins/audio-player/assets/player.swf?ver=2.0.4.6", {width:"290",animation:"yes",encode:"yes",initialvolume:"60",remaining:"no",noinfo:"no",buffer:"5",checkpolicy:"no",rtl:"no",bg:"E5E5E5",text:"333333",leftbg:"CCCCCC",lefticon:"333333",volslider:"666666",voltrack:"FFFFFF",rightbg:"B4B4B4",rightbghover:"999999",righticon:"333333",righticonhover:"FFFFFF",track:"FFFFFF",loader:"009900",border:"CCCCCC",tracker:"DDDDDD",skip:"666666",pagebg:"FFFFFF",transparentpagebg:"yes"});</script>

<!-- start miniAudioPlayer custom CSS -->

<style id="map_custom_css">
       /*++++++++++++++++++++++++++++++++++++++++++++++++++
MAP custom skin: mySkin
http://pupunzi.com/mb.components/mb.miniAudioPlayer/demo/skinMaker.html

background: rgba(235, 21, 21, 1)
icons: rgba(255, 254, 250, 1)
border: rgba(235, 101, 110, 1)
borderLeft: rgba(230, 3, 3, 1)
borderRight: rgba(184, 14, 14, 1)
mute: rgba(255, 61, 61, 1)
download: rgba(212, 32, 38, 0.48)
downloadHover: rgba(255, 3, 3, 1)
++++++++++++++++++++++++++++++++++++++++++++++++++*/

/* Older browser (IE8) not supporting rgba() */
.mbMiniPlayer.mySkin.shadow table{box-shadow:0 0 3px #1c0606;}
.mbMiniPlayer.mySkin table span{background-color:#eb1515;}
.mbMiniPlayer.mySkin table span.map_play{border-left:1px solid #e60303;}
.mbMiniPlayer.mySkin table span.map_volume{border-right:1px solid #b80e0e;}
.mbMiniPlayer.mySkin table span.map_volume.mute{color: #ff3d3d;}
.mbMiniPlayer.mySkin .map_download{color: #d42026;}
.mbMiniPlayer.mySkin .map_download:hover{color: #ff0303;}
.mbMiniPlayer.mySkin table span{color: #fffefa;}
.mbMiniPlayer.mySkin table {border: 1px solid #eb656e !important;}

/*++++++++++++++++++++++++++++++++++++++++++++++++*/

.mbMiniPlayer.mySkin table{background-color:transparent;}
.mbMiniPlayer.mySkin.shadow table{box-shadow:0 0 3px rgba(28, 6, 6, 0.01);}
.mbMiniPlayer.mySkin table span{background-color:rgba(235, 21, 21, 1);}
.mbMiniPlayer.mySkin table span.map_play{border-left:1px solid rgba(230, 3, 3, 1);}
.mbMiniPlayer.mySkin table span.map_volume{border-right:1px solid rgba(184, 14, 14, 1);}
.mbMiniPlayer.mySkin table span.map_volume.mute{color: rgba(255, 61, 61, 1);}
.mbMiniPlayer.mySkin .map_download{color: rgba(212, 32, 38, 0.48);}
.mbMiniPlayer.mySkin .map_download:hover{color: rgba(255, 3, 3, 1);}
.mbMiniPlayer.mySkin table span{color: rgba(255, 254, 250, 1);text-shadow: 1px -1px 1px rgba(189, 11, 11, 1)!important;}
.mbMiniPlayer.mySkin table span{color: rgba(255, 254, 250, 1);}
.mbMiniPlayer.mySkin table {border: 1px solid rgba(235, 101, 110, 1) !important;}
.mbMiniPlayer.mySkin table span.map_title{color: #000; text-shadow:none!important}
/*++++++++++++++++++++++++++++++++++++++++++++++++*/
</style>
	
<!-- end miniAudioPlayer custom CSS -->
	
<style type="text/css">
.paypal-donations { text-align: center !important }
</style>
</head>
<body class="single single-post postid-345 single-format-standard">

<div id="page">
	<div id="header" class="clear-fix">
		<div id="logo">
						<h3 id="site-title">
				<span>
					<a href="http://www.filfre.net/" title="The Digital Antiquarian" rel="home">The Digital Antiquarian</a>
				</span>
			</h3>
			<div class="description">A history of computer entertainment by Jimmy Maher</div>

		</div><!-- #logo -->
		
		<div id="nav">
			<ul class="menu"><li ><a href="http://www.filfre.net/">Home</a></li><li class="page_item page-item-4"><a href="http://www.filfre.net/about-me/">About Me</a></li><li class="page_item page-item-1903"><a href="http://www.filfre.net/hall-of-fame/">Hall of Fame</a></li><li class="page_item page-item-1179"><a href="http://www.filfre.net/sitemap/">Table of Contents</a></li></ul>
		</div><!-- #nav -->

	</div><!-- #header -->
	
	<div id="main">
		<a href="http://www.filfre.net/feed/rss/" id="rss-link">RSS</a>
		<div id="main-top">
			<div id="main-bot" class="clear-fix">
				<div id="content">					
					<div class="post-navigation clear-fix">
						<div class="nav-previous">
							<a href="http://www.filfre.net/2012/01/the-birth-of-infocom/" rel="prev"><span class="meta-nav">&larr;</span> The Birth of Infocom</a>						</div>
						<div class="nav-next">
							<a href="http://www.filfre.net/2012/01/selling-zork/" rel="next">Selling Zork <span class="meta-nav">&rarr;</span></a>						</div>
					</div><!-- .post-navigation -->
					
					<div class="post-345 post type-post status-publish format-standard hentry category-digital-antiquaria category-interactive-fiction tag-apple-ii tag-infocom tag-zork">
						<h1 class="post-title">ZIL and the Z-Machine</h1>
						<div class="date">
							<div class="bg">
								<span class="day">07</span>
								<span>Jan</span>
							</div>
						</div><!-- .date -->
						
						<div class="entry">
														<p>When we left off last time, Marc Blank and Joel Berez were considering how to bring <em>Zork</em> to the microcomputer. Really, they were trying to solve three interrelated problems. At the risk of being pedantic, let me lay out them for you:</p>
<p>1. How to get <em>Zork</em>, a massive game that consumed 1 MB of memory on the PDP-10, onto their chosen minimum microcomputer system, an Apple II or TRS-80 with 32 K of RAM and a single floppy-disk drive.</p>
<p>2. How to do so in a portable way that would make it as painless as possible to move <em>Zork</em> not only to the Apple II and TRS-80 but also, if all went well, to many more current and future mutually incompatible platforms.</p>
<p>3. How to use the existing MDL source code to <em>Zork</em> as the basis for the new microcomputer version, rather than having to start all over again and implement the game from scratch in some new environment.</p>
<p>If you like, you can see the above as a ranking of the problems in order of importance, from &#8220;absolutely, obviously essential&#8221; to &#8220;would be really nice.&#8221; That&#8217;s not strictly necessary, though, because, as we&#8217;re about to see, Blank and Berez, with the eventual help of the others, actually solved them all pretty brilliantly. I wish I could neatly deal with each item above one at a time, but, as anyone who&#8217;s ever tackled a complicated programming task knows, solutions tend to get tangled up with one another pretty quickly. So instead I&#8217;ll have to just ask you to keep those three goals in mind as I explain how Blank and Berez&#8217;s design worked as a whole.</p>
<p>When faced with a game that is just too large to fit into a new environment, the most obvious solution is simply to make the game smaller &#8212; to remove content. That&#8217;s one of the things Infocom did with <em>Zork</em>. <a href="http://www.csd.uwo.ca/Infocom/Articles/NZT/zorkhist.html">Stu Galley</a>:</p>
<blockquote><p>Dave examined his complete map of Zork and drew a boundary around a portion that included about 100 or so locations: everything &#8220;above ground&#8221; and a large section surrounding the Round Room. The object was to create a smaller Zork that would fit within the constraints established by the design of Joel and Marc. Whatever wouldn&#8217;t fit was to be saved for another game, another day.</p></blockquote>
<p>By cutting <em>Zork</em>&#8216;s world almost in half, Infocom were able to dramatically reduce the size of the game. 191 rooms became 110; 211 items became 117; 911 parseable words became 617. It wasn&#8217;t a complete solution to their problems, but it certainly helped, and still left them with a huge game, about the same size as the original <em>Adventure</em> in numbers of rooms but dwarfing it in terms of items and words, and easily bigger than any other microcomputer adventure game. And, as Galley notes above, it left them with plenty of raw material out of which to build a possible sequel.</p>
<p>There were more potential savings to be had by looking at the MDL compiler. As a language designed to perform many general-purpose computing tasks, many of MDL&#8217;s capabilities naturally went unused by an adventure game like <em>Zork</em>. Even unused, however, they consumed precious memory. Infocom therefore took a pair of pruning shears to MDL just as they had to <em>Zork</em> itself, cutting away extraneous syntax and libraries, and retaining only what was necessary for implementing an adventure game. They named the new language ZIL, for <em>Zork</em> Implementation Language; the compiler that enabled the language, which still ran only on the PDP-10, they called Zilch. ZIL remained similar enough to MDL in syntax and approach that porting the old MDL <em>Zork</em> to ZIL was fairly painless, yet the new language not only produced tighter, faster executables but was much cleaner syntactically. In fact, ZIL encouraged Infocom to not just port <em>Zork</em> to the new language but to improve it in some ways; the parser, in particular, became even better when implemented in the more sympathetic ZIL.</p>
<p>Here is <em>Zork</em>&#8216;s lantern in MDL:</p>
<pre>&lt;OBJECT ["LAMP" "LANTE" "LIGHT"]
	["BRASS"]
	"lamp"
	&lt;+ ,OVISON ,TAKEBIT ,LIGHTBIT&gt;
	LANTERN
	()
	(ODESCO "A battery-powered brass lantern is on the trophy case."
	 ODESC1 "There is a brass lantern (battery-powered) here."
	 OSIZE 15
	 OLINT [0 &lt;CLOCK-DISABLE &lt;CLOCK-INT ,LNTIN 350&gt;&gt;])&gt;</pre>
<p>And here&#8217;s the same item in ZIL:</p>
<pre>&lt;OBJECT LANTERN 
                (LOC LIVING-ROOM) 
                (SYNONYM LAMP LANTERN LIGHT) 
                (ADJECTIVE BRASS) 
                (DESC "brass lantern") 
                (FLAGS TAKEBIT LIGHTBIT) 
                (ACTION LANTERN-F) 
                (FDESC "A battery-powered lantern is on the trophy 
               case.") 
                (LDESC "There is a brass lantern (battery-powered) 
               here.") 
                (SIZE 15)&gt;</pre>
<p>Just for the record, I&#8217;ll give a quick explanation of the ZIL code shown above for those interested. The first line simply tells us that what follows will describe an item &#8212; or, in ZIL terminology, &#8220;object&#8221; &#8212; called &#8220;lantern.&#8221; The next line tells us it is in the living room of the white house. Then we see that it can be referred to by the player as &#8220;lamp,&#8221; &#8220;lantern,&#8221; or &#8220;light,&#8221; with the optional adjective &#8220;brass&#8221; (which might come in handy to distinguish it from the broken lantern found in another part of the game). The so-called short description &#8212; more properly the name under which it shows up in inventory listings and other places where it must be plugged into the text  &#8212; is &#8220;brass lantern.&#8221; The TAKEBIT flag means that it is an item the player can pick up and carry around with her; the LIGHTBIT means that it casts light, illuminating any dark room in which it is placed or carried. LANTERN-F is the special action routine for the lantern, a bit of code that allows us to write special &#8220;rules&#8221; for the lantern that apply only to it, such as routines to allow the player to turn it off and on; as I discussed earlier, this level of programmability and the associated object-oriented approach really make MDL, and by extension ZIL, stand out from other adventure-game development systems of their era. The FDESC is the description of the lantern that appears before it has been moved, as part of the room description for the living room; the LDESC appears after it has been moved and set down somewhere else. Finally, the SIZE determines the size and weight of the lantern for purposes of deciding how much the player can carry with her at one time. The rather messier MDL source I&#8217;ll leave as an exercise for you to translate&#8230;</p>
<p>So, at this point Infocom have largely addressed problem #3, and at least come a long way with problem #1. That left them still with problem #2. You might think it would be easy enough to design an adventure-engine / database partnership like that Scott Adams came up with. However, this was problematic. Remember that one of the things that made <em>Zork</em>&#8216;s development environment, whether it be MDL or ZIL, so unique was its programmability. To go to a solution like that of Adams would force them to sacrifice that, and ZIL in the process. For ZIL to work, it needed to be able to <em>run code</em> to handle those special interactions like turning the lamp on or off; it needed, in other words, to be a proper, <a href="http://en.wikipedia.org/wiki/Turing_complete">Turing-complete</a> programming language, not just a data-entry system. But how to do that while also having a system that was portable from machine to (incompatible) machine? The answer: they would design a <em>virtual</em> machine, an imaginary computer optimized just for playing text adventure in the same way that ZIL was for coding them, then code an interpreter to simulate that computer on each platform for which they decided to release <em>Zork</em>. </p>
<p>Virtual machines are everywhere today. The apps you run on your Android smartphone actually run inside a virtual machine. You might use something like VMWare on your desktop machine to let you run Linux inside Windows, or vice versa. Big mainframe installations and, increasingly, high-end servers running operating systems like Linux often run in virtual machines abstracted from the underlying hardware, which amongst other benefits lets one carve one giant mainframe up into a number of smaller mainframes. Scenarios like that aside, virtual machines are so appealing for essentially two reasons; virtually (ha!) everyone who decides to employ one does so for one or the other, or, often, both. First, they are much more secure. If malicious code such as a virus gets introduced into a virtual machine, it is contained there rather rather than infecting the host system, and code that crashes the virtual machine &#8212; whether it does so intentionally or accidentally &#8212; crashes <em>only</em> the virtual machine, not the host system as a whole. Second, a virtual machine allows one to run the same program on otherwise incompatible devices. It is &#8220;write once, run everywhere,&#8221; as Java zealots used to say. In their case, each target platform need only have a current implementation of the Java virtual machine (not necessarily the language; <em>just</em> the virtual machine). Virtual machines do also have one big disadvantage: because the host platform is emulating another computer, they tend to be much, much slower than native code run on the same platform. (Yes, technologies like just-in-time compilation can do a lot to alleviate this, but let&#8217;s not get any further afield.) Still, computing power is cheap and ubiquitous these days, so this generally doesn&#8217;t present such a problem. In fact, the modern situation can get kind of ridiculous; my Kindle version of <em>The King of Shreds and Patches</em> is actually built from one virtual machine (Glulx) running inside another virtual machine (the Java virtual machine), all running on a tiny handheld e-reader &#8212; and performance is <em>still</em> acceptable.</p>
<p>Even in 1979 the virtual machine was not a new idea. Between 1965 and 1967, a team at IBM had worked in close partnership with MIT&#8217;s Lincoln Laboratory to create an operating system called <a href="http://en.wikipedia.org/wiki/CP-40">CP-40</a>, under which up to 14 users were each able to log into their own, single-user computer &#8212; simulated entirely in software running on a big IBM mainframe. CP-40 eventually became the basis of the appropriately named <a href="http://en.wikipedia.org/wiki/VM_%28operating_system%29">VM operating system</a>, first released by IBM in 1972 and still widely used on mainframes today. In 1978, a <a href="http://en.wikipedia.org/wiki/Programming_language">Pascal</a> implementation known as <a href="http://en.wikipedia.org/wiki/Ucsd_pascal">UCSD Pascal</a> introduced the P-Machine, a portable virtual machine that allowed programs written in UCSD Pascal to run on many disparate machines, including even the Apple II following the release of <a href="http://en.wikipedia.org/wiki/Apple_Pascal">Apple Pascal</a> in August of 1979. The P-Machine became a major influence on Infocom&#8217;s own virtual machine, the Z-Machine.</p>
<p>In opting for a virtual machine they would of course have to pay the performance penalty all virtual machiness enact, but this wouldn&#8217;t be quite as big as you might expect. Just as they had optimized ZIL, Blank and Berez made the Z-Machine as light and efficient as they possibly could, including only those features really useful for running adventure games. They would implement each platform&#8217;s interpreter entirely in highly optimized assembly language, with the result that <em>Zork</em> would, even running inside a virtual machine, still run much, much faster than the BASIC adventures that were common at the time. Anyway, the processing powers of the micros, limited as they were, had never been their real concern in getting <em>Zork</em> onto them &#8212; <em>memory</em> was the bottleneck. Yes, they would have to sacrifice some additional memory for the interpreter, but they could save even more by building efficiencies into the Z-Machine. For instance, a special encoding scheme allowed them to store most characters in 5 rather than 8 bits, and to replace the most commonly used words with abbreviations in the code. Such text compression was very significant considering that text is, after all, most of what makes up a text adventure. With such compression techniques, along with all of the slicing and dicing of the game itself and the ZIL language, they ended up with a final game just 77 K in size, not counting of course the virtual-machine interpreter needed to run it; this latter Infocom called Zip (not to be confused with the file-compression format). The 77 K game file itself, which Infocom took to calling the &#8220;story file,&#8221; is essentially a snapshot of the virtual machine&#8217;s memory in its opening state.</p>
<p>When we talk about the storage capacity of a computer, we&#8217;re really talking about (much to the confusion of parents and grandparents everywhere) two separate figures: disk capacity and memory (RAM) capacity. An Apple II could store 140 K on a single floppy disk, while the TRS-80 actually did a bit better, managing 180 K. Thus, Infocom now had a game that could fit quite comfortably along with the necessary interpreter on a single disk. RAM was the problem: even if we forget about the necessary interpreter, 77 K just doesn&#8217;t go into 32 K, no matter how much you try to force it. Or does it?</p>
<p>It was not unheard of even at this time to use the disk as a sort of secondary memory, reading bits and pieces of data from there into RAM and then discarding them when no longer needed. Microsoft had used just this technique to fit <em>Adventure</em> into the 32 K TRS-80; each bit of text, all stored in a file external to the game itself as per Crowther and Woods&#8217;s original design, was read in from disk only when it needed to be printed. However, Infocom&#8217;s more sophisticated object-oriented system necessarily intermingled its text with its code, making such a segregated approach impractical. Blank and Berez therefore went a step further: having already designed a virtual machine, they now added an implementation of virtual memory to accompany it.</p>
<p>The concept of virtual memory was also then not a new one in the general world of computer science. In fact, virtual memory dates back even further than the virtual machine, to an early supercomputer developed at the University of Manchester called <a href="http://en.wikipedia.org/wiki/Atlas_Computer_%28Manchester%29">the Atlas</a>, officially commissioned in 1962. In a virtual-memory system, each program does not have an &#8220;honest&#8221; view of the host computer&#8217;s physical memory. It rather is given a sort of idealized memory map to play with, which may have little to do with the real layout of its host computer&#8217;s physical RAM. When it reads from and writes to pieces of this map, the host automatically translates the virtual addresses into real addresses inside its physical memory, transparently. Why bother with such a thing, especially as it necessarily adds processing overhead? Once again, for two main reasons, both of which are usually taken as applicable to a multitasking operating system only, something that was little more than a dream for a microcomputer of 1979 or 1980. First, by effectively sandboxing each program&#8217;s memory from every other program&#8217;s memory, as well as that being used by the operating system itself, virtual memory assures that a program cannot, out of malice or simple bugginess, go rogue and trash other programs or even bring down the whole system. Second, it gives a computer a fallback position of sorts &#8212; an alternative to outright failure &#8212; should the program(s) running on it ask for more physical memory than it actually has to give. When that happens, the operating system looks through its memory to find pieces that aren&#8217;t being used very often. It then caches these away on disk, making room in physical RAM to allocate the new request. When cached areas are accessed again, they must of course be read back into RAM, possibly being swapped with other chunks if memory is still scarce. All of this happens transparently to the program(s) in question, which continue to live within their idealized view of memory, blissfully unaware of the huffing and puffing the underlying system is doing to keep everything going. Virtual memory has been with us for many years now in the desktop PC world. Of course, there inevitably comes a point of diminishing returns with such a scheme; if you&#8217;ve ever opened lots and lots of windows or programs on an older PC and seen everything get really, really slow while the hard disk grinds like a saw mill, now you know what was going on (assuming you didn&#8217;t already know, of course; we assume no default level of technical knowledge here at Digital Antiquaria Central).</p>
<p>For the Z-Machine, Berez and Blank employed a much simpler version of virtual memory than you&#8217;ll find in the likes of Windows, Linux, or OS X. While such important dynamic information as the current position of the items in the game world must of course always be tracked and updated dynamically, most of the data that makes up a game like <em>Zork</em> is static, unchanging: lots and lots of text, of course, along with lots of program code. Berez and Blank were able to design the ZIL compiler in such a way that it placed all of the stuff that could conceivably change, which we&#8217;ll called the dynamic data, first in the story file. Everything else, which we&#8217;ll call the static data, came afterward. As it turned out, the 77 K <em>Zork</em> story file contained only 18 K of dynamic data. So, here&#8217;s what they did&#8230;</p>
<p>The dynamic data &#8212; memory the virtual machine will write to as well as read &#8212; is always stored in the host computer&#8217;s RAM. The static data, however, is loaded in and out of RAM by the interpreter as needed in 1 K blocks known as pages. Put another way: from the perspective of the game program, it has fully 77 K of memory to work with. The interpreter, meanwhile, is frantically swapping blocks of memory in an out of the much more limited physical RAM to maintain this illusion. Like the virtual machine itself, this virtual-memory scheme obviously brings with it a speed penalty, but needs must. On a 32 K system with 18 K reserved for dynamic data, Infocom still had 14 K left over to host the VM interpreter itself, a small stack (an area where programs store temporary information needed for moment-to-moment processing), and a page or two of virtual memory. Sure, it was a bit sluggish at times, but it worked. And, when run on a system with, say, 48 K, the interpreter could automatically detect and use this additional memory to keep more static data in physical RAM, thus speeding things along and rewarding the user for her hardware investment.</p>
<p>With the ZIL / Z-Machine scheme as a whole, Infocom had created a robust, reusable system that could have life far beyond this one-time task of squeezing <em>Zork</em> onto the TRS-80 and Apple II. I trust I&#8217;m not spoiling anything if I reveal that that&#8217;s exactly what happened.</p>
<p>With this technical foundation, we&#8217;ll look next time at the process of actually getting <em>Zork</em> onto the market.</p>
							<div class="cl">&nbsp;</div>
							
														
													</div><!-- .entry -->
						
												
						<div class="meta">
							<div class="bg">
								<span class="comments-num"><a href="http://www.filfre.net/2012/01/zil-and-the-z-machine/#comments">6 Comments</a></span>
								<p>Posted by <a href="http://www.filfre.net/author/jimmy-maher/" title="Posts by Jimmy Maher" rel="author">Jimmy Maher</a> on January 7, 2012 in <a href="http://www.filfre.net/category/digital-antiquaria/" rel="category tag">Digital Antiquaria</a>, <a href="http://www.filfre.net/category/interactive-fiction/" rel="category tag">Interactive Fiction</a></p>
							</div>
							<div class="bot">&nbsp;</div>
						</div><!-- .meta -->
						
						<p class="tags">Tags: <a href="http://www.filfre.net/tag/apple-ii/" rel="tag">apple ii</a>, <a href="http://www.filfre.net/tag/infocom/" rel="tag">infocom</a>, <a href="http://www.filfre.net/tag/zork/" rel="tag">zork</a></p>					
					</div><!-- .post -->
					
					<div class="post-navigation clear-fix">
						<div class="nav-previous">
							<a href="http://www.filfre.net/2012/01/the-birth-of-infocom/" rel="prev"><span class="meta-nav">&larr;</span> The Birth of Infocom</a>						</div>
						<div class="nav-next">
							<a href="http://www.filfre.net/2012/01/selling-zork/" rel="next">Selling Zork <span class="meta-nav">&rarr;</span></a>						</div>
					</div><!-- .post-navigation -->
					
					
			<div id="comments">


			<h3 id="comments-title">6 Responses to <em>ZIL and the Z-Machine</em></h3>


			<ol class="commentlist">
					<li class="comment even thread-even depth-1 comment">
		<div class="comment-body" id="comment-5555">
						<p class="author">
				<a href='http://www.z-machine-matter.com' rel='external nofollow' class='url'>ZUrlocker</a>			</p>
			<p class="comment-meta">
				January 8, 2012 at 1:41 am			</p>
			<div class="comment-content">
				
				<p>Great explanation of the Z-Machine architecture!  Thank you.</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5555#respond' onclick='return addComment.moveForm( "comment-5555", "5555", "respond", "345" )' aria-label='Reply to ZUrlocker'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1 comment">
		<div class="comment-body" id="comment-5558">
						<p class="author">
				Joshua Buergel			</p>
			<p class="comment-meta">
				January 8, 2012 at 5:32 am			</p>
			<div class="comment-content">
				
				<p>A minor correction:  technically, the VM inside Android is a Dalvik VM, not a true Java VM.  The compiled Java bytecodes are actually translated to Dalvik compatible instructions before moving over.  It makes no practical difference to end users, and indeed to the majority of developers working on the platform, but it is kind of interesting.</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5558#respond' onclick='return addComment.moveForm( "comment-5558", "5558", "respond", "345" )' aria-label='Reply to Joshua Buergel'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	<ul class="children">
	<li class="comment byuser comment-author-jimmy-maher bypostauthor even depth-2 comment">
		<div class="comment-body" id="comment-5563">
						<p class="author">
				Jimmy Maher			</p>
			<p class="comment-meta">
				January 8, 2012 at 8:47 am			</p>
			<div class="comment-content">
				
				<p>Ah, thanks. I&#8217;ve just been dipping into Android development recently, and still have much to learn.</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5563#respond' onclick='return addComment.moveForm( "comment-5563", "5563", "respond", "345" )' aria-label='Reply to Jimmy Maher'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	<ul class="children">
	<li class="comment odd alt depth-3 comment">
		<div class="comment-body" id="comment-5564">
						<p class="author">
				<a href='http://wadeclarke.com' rel='external nofollow' class='url'>Wade</a>			</p>
			<p class="comment-meta">
				January 8, 2012 at 1:35 pm			</p>
			<div class="comment-content">
				
				<p>I had to come up with my own version of this virtual-memory-on-floppies scheme to get my Eamon game Leadlight to run.</p>
<p>In using APPLESOFT I was limited to accessing the first 64kb of RAM of a 128kb machine. Then, the latest 8-bit Apple II OS &#8212; ProDOS &#8212; had to be in memory all the time, leaving me with something like 33kb RAM for the program and the dynamic variables.</p>
<p>The game is about 280kb overall (2 floppies) and there&#8217;s no text compression available in Applesoft. In the end, I had to remove all English language PRINT statements from the program and farm them out to random disk access, too. The disk(s) spins super frequently while playing. The code is a chore to read as all messages are represented by numbers that you have to look up in a database. But it&#8217;s super RAM efficient.</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5564#respond' onclick='return addComment.moveForm( "comment-5564", "5564", "respond", "345" )' aria-label='Reply to Wade'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
</ul><!-- .children -->
</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1 comment">
		<div class="comment-body" id="comment-5567">
						<p class="author">
				Geoff			</p>
			<p class="comment-meta">
				January 8, 2012 at 7:39 pm			</p>
			<div class="comment-content">
				
				<p>Jimmy &#8211; just a note to say how much I enjoy your articles.  I love the technical explanations as well as the information about the historical and other contexts.  I look forward to posts on your site, and often read them twice.  I&#8217;m a bit of an old software buff, so this stuff is great for me.  Thanks!</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5567#respond' onclick='return addComment.moveForm( "comment-5567", "5567", "respond", "345" )' aria-label='Reply to Geoff'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1 comment">
		<div class="comment-body" id="comment-5578">
						<p class="author">
				Mike			</p>
			<p class="comment-meta">
				January 9, 2012 at 8:28 am			</p>
			<div class="comment-content">
				
				<p>I just wanted to say that it really makes my day when you put up a new post. I&#8217;m a bit too young to have &#8220;lived through it&#8221; (besides playing Oregon Trail on an Apple II), but your unique combination of history and technical detail makes for absolutely engrossing reading. Thanks for all the hard work.</p>
				<div class="alignleft"></div>

			</div>
			<div class="reply">
				<a rel='nofollow' class='comment-reply-link' href='http://www.filfre.net/2012/01/zil-and-the-z-machine/?replytocom=5578#respond' onclick='return addComment.moveForm( "comment-5578", "5578", "respond", "345" )' aria-label='Reply to Mike'>Reply</a>			</div>
			<div class="cl">&nbsp;</div>
		</div>
	</li><!-- #comment-## -->
			</ol>



						<div id="respond" class="comment-respond">
				<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2012/01/zil-and-the-z-machine/#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://www.filfre.net/wp-comments-post.php" method="post" id="commentform" class="comment-form">
																			<p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-describedby="email-notes" aria-required='true' required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8"  aria-required="true" required="required"></textarea></p>						
						<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='345' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="d2ff28f0a1" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="213"/></p>					</form>
							</div><!-- #respond -->
			
</div><!-- #comments -->				
				
				</div><!-- END Content -->
				<div id="sidebar">
					<ul class="xoxo">
						<li id="paypal_donations-2" class="widget widget_paypal_donations"><h4 class="widgettitle">Support this blog</h4><p style="margin-left:1em; margin-right: 1em"><strong>If you value this blog, please think about supporting it by becoming a Patreon patron or via a one-time PayPal donation. Thanks!</strong> </p>
<pre>&nbsp;</pre>
<p align="center"><a href="http://www.patreon.com/DigitalAntiquarian"><img src="/misc/Patreon.png" width=175 height=60></a></p>
<p></p>
<!-- Begin PayPal Donations by https://www.tipsandtricks-hq.com/paypal-donations-widgets-plugin -->

<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
    <div class="paypal-donations">
        <input type="hidden" name="cmd" value="_donations" />
        <input type="hidden" name="bn" value="TipsandTricks_SP" />
        <input type="hidden" name="business" value="maher@filfre.net" />
        <input type="hidden" name="item_name" value="Donation to The Digital Antiquarian blog" />
        <input type="hidden" name="currency_code" value="USD" />
        <input type="image" src="https://www.paypal.com/en_US/i/btn/btn_donate_LG.gif" name="submit" alt="PayPal - The safer, easier way to pay online." />
        <img alt="" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" />
    </div>
</form>
<!-- End PayPal Donations -->
</li><li id="text-6" class="widget widget_text"><h4 class="widgettitle">Hall of Fame</h4>			<div class="textwidget"><a href="/about-me/hall-of-fame">A chronological list of fun and/or interesting works that respect your time and won't screw you over.</a></div>
		</li><li id="text-5" class="widget widget_text"><h4 class="widgettitle">Table of Contents</h4>			<div class="textwidget"><a href="/about-me/sitemap">Read this blog in chronological order, like a book.</a></div>
		</li><li id="text-4" class="widget widget_text"><h4 class="widgettitle">Twitter</h4>			<div class="textwidget">Receive announcements of new articles by following <a href="https://twitter.com/DigiAntiquarian">DigiAntiquarian on Twitter</a>.</div>
		</li><li id="nav_menu-3" class="widget widget_nav_menu"><h4 class="widgettitle">My Projects</h4><div class="menu-my-projects-container"><ul id="menu-my-projects" class="menu"><li id="menu-item-510" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-510"><a href="http://amiga.filfre.net">The Future Was Here: The Commodore Amiga</a></li>
<li id="menu-item-9" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9"><a href="http://maher.filfre.net/King">The King of Shreds and Patches</a></li>
<li id="menu-item-10" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-10"><a href="http://maher.filfre.net/filfre">Filfre: A Windows IF Interpreter</a></li>
<li id="menu-item-11" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11"><a href="http://maher.filfre.net/if-book">Let&#8217;s Tell a Story Together: A History of Interactive Fiction</a></li>
<li id="menu-item-203" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-203"><a href="http://www.filfre.net/misc/impetuous">His Majesty&#8217;s Ship Impetuous</a></li>
<li id="menu-item-12" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-12"><a href="http://maher.filfre.net/if">Older IF Writings and Reviews</a></li>
<li id="menu-item-13" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-13"><a href="http://maher.filfre.net/writings">Miscellaneous Juvenilia</a></li>
<li id="menu-item-14" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-14"><a href="http://www.filfre.net/about-me/">About Me</a></li>
</ul></div></li><li id="search-3" class="widget widget_search"><h4 class="widgettitle">Search</h4><form action="http://www.filfre.net/" id="searchform" method="get">
	<label for="s" class="screen-reader-text">Search</label>
	<div class="field-place">
		<input type="text" class="field" id="s" name="s" value=""/>
		<input type="submit" class="button" value="Search" id="searchsubmit"/>
	</div>
</form></li><li id="calendar-3" class="widget widget_calendar"><h4 class="widgettitle">Calendar</h4><div id="calendar_wrap"><table id="wp-calendar">
	<caption>January 2012</caption>
	<thead>
	<tr>
		<th scope="col" title="Monday">M</th>
		<th scope="col" title="Tuesday">T</th>
		<th scope="col" title="Wednesday">W</th>
		<th scope="col" title="Thursday">T</th>
		<th scope="col" title="Friday">F</th>
		<th scope="col" title="Saturday">S</th>
		<th scope="col" title="Sunday">S</th>
	</tr>
	</thead>

	<tfoot>
	<tr>
		<td colspan="3" id="prev"><a href="http://www.filfre.net/2011/12/">&laquo; Dec</a></td>
		<td class="pad">&nbsp;</td>
		<td colspan="3" id="next"><a href="http://www.filfre.net/2012/02/">Feb &raquo;</a></td>
	</tr>
	</tfoot>

	<tbody>
	<tr>
		<td colspan="6" class="pad">&nbsp;</td><td><a href="http://www.filfre.net/2012/01/01/" title="The Roots of Infocom">1</a></td>
	</tr>
	<tr>
		<td>2</td><td><a href="http://www.filfre.net/2012/01/03/" title="Zork on the PDP-10">3</a></td><td>4</td><td><a href="http://www.filfre.net/2012/01/05/" title="The Birth of Infocom">5</a></td><td>6</td><td><a href="http://www.filfre.net/2012/01/07/" title="ZIL and the Z-Machine">7</a></td><td>8</td>
	</tr>
	<tr>
		<td>9</td><td>10</td><td><a href="http://www.filfre.net/2012/01/11/" title="Selling Zork">11</a></td><td>12</td><td>13</td><td>14</td><td>15</td>
	</tr>
	<tr>
		<td><a href="http://www.filfre.net/2012/01/16/" title="Parser Games">16</a></td><td>17</td><td><a href="http://www.filfre.net/2012/01/18/" title="Exploring Zork, Part 1">18</a></td><td>19</td><td><a href="http://www.filfre.net/2012/01/20/" title="Exploring Zork, Part 2">20</a></td><td>21</td><td><a href="http://www.filfre.net/2012/01/22/" title="Exploring Zork, Part 3">22</a></td>
	</tr>
	<tr>
		<td><a href="http://www.filfre.net/2012/01/23/" title="Escape!">23</a></td><td>24</td><td><a href="http://www.filfre.net/2012/01/25/" title="Silas Warner and Muse Software">25</a></td><td>26</td><td><a href="http://www.filfre.net/2012/01/27/" title="The King of Shreds and Patches, Kindle Touch Version &#8212; and Some Answers">27</a></td><td>28</td><td>29</td>
	</tr>
	<tr>
		<td><a href="http://www.filfre.net/2012/01/30/" title="Robot War">30</a></td><td>31</td>
		<td class="pad" colspan="5">&nbsp;</td>
	</tr>
	</tbody>
	</table></div></li><li id="text-3" class="widget widget_text"><h4 class="widgettitle">Email</h4>			<div class="textwidget">maher AT filfre DOT net</div>
		</li>					</ul>
				</div><!-- END Sidebar -->
				<div class="cl">&nbsp;</div>					</div><!-- #main-bot -->
				</div><!-- #main-top -->
			</div><!-- #main -->
			<div id="footer">
				<p><a href="http://wordpress.org/" rel="generator">Proudly powered by WordPress</a>
Theme: Choco by <a href="http://cssmayo.com" rel="designer">.css{mayo}</a>.</p>
							
				<p class="rss"><a href="http://www.filfre.net/feed/rss/">Entries (RSS)</a> and <a href="http://www.filfre.net/comments/feed/">Comments (RSS)</a></p>
			</div><!-- #footer -->
		</div><!-- #page -->
		<!-- Powered by WPtouch: 3.8.6 --><script type='text/javascript' src='http://www.filfre.net/wp-content/plugins/akismet/_inc/form.js?ver=3.1.3'></script>
<script type='text/javascript' src='http://www.filfre.net/wp-includes/js/comment-reply.min.js?ver=4.3.1'></script>

	<!-- start miniAudioPlayer initializer -->
	<script type="text/javascript">

	var miniAudioPlayer_replaceDefault = true;
	var miniAudioPlayer_excluded = "map_excluded";
	var miniAudioPlayer_replaceDefault_show_title = false;

	var miniAudioPlayer_defaults = {
				inLine:true,
                width:"250",
				skin:"black",
				animate:true,
				volume:.2,
				autoplay:false,
				showVolumeLevel:true,
				allowMute: false,
				showTime:true,
				id3:false,
				showRew:true,
				addShadow: false,
				downloadable:false,
				downloadPage:"http://www.filfre.net/wp-content/plugins/wp-miniaudioplayer/map_download.php",
				swfPath:"http://www.filfre.net/wp-content/plugins/wp-miniaudioplayer/js/",
				onReady: function(player, $controlsBox){
				   if(player.opt.downloadable && player.opt.downloadablesecurity && !false){
				        jQuery(".map_download", $controlsBox).remove();
				   }
				}
		};

    function initializeMiniAudioPlayer(){
    	  jQuery(".mejs-container a").addClass(miniAudioPlayer_excluded);
         jQuery("a[href*='.mp3'] ,a[href*='.m4a']").not(".map_excluded").not(".wp-playlist-caption").mb_miniPlayer(miniAudioPlayer_defaults);
    }

	jQuery(function(){

        if(true)
          replaceDefault();

          initializeMiniAudioPlayer();
          jQuery(document).ajaxSuccess(function(event, xhr, settings) {
           	initializeMiniAudioPlayer();
          });
	});
	</script>
	<!-- end miniAudioPlayer initializer -->

		</body>
</html>